# CypherGuard
This repository contains a first version of a **G**rammar-**U**tilized **A**dvisor of **R**elationship **D**irections (GUARD) for Cypher queries. 
The utility function here can be used together with LLM-generated Cypher, as a post-processing step to correct queries.

See `src/example.py` for a basic usage example.

Advantages of using Cypher grammar together with schema information are:

- Fast: it takes 5-10 milliseconds to correct relationship directions in a query.
- Deterministic: a grammar-based approach produces the same output every time.
- Simple: around ~300 lines of Python code (excluding autogenerated [antlr4](https://www.antlr.org/) files)

The code here was created for the [Cypher direction validation competition](https://github.com/tomasonjo/cypher-direction-competition/tree/main), in August 2023.

## Folder Structure

```
/src/guard/            | Root folder for the library.
/src/guard/generated/  | Auto-generated parser/lexer based on Cypher Antlr4 Grammar.
/data/                 | Training data.
example.py             | A minimal example on how to use the library.
evaluate.py            | A quick script to evaluate the library on a CSV file with multiple queries.
```

## Setup & Run
This code was tested with Python 3.10.8. 

To install dependencies (Cypher AST parser):
```
pip3 install -r requirements.txt
```

To run the basic example:
```
python3 src/example.py 
```

To validate a set of queries from a CSV file:
```
python3 src/evaluate.py
````
(This should successfully correct 74/74 queries specified in `examples.csv`)

